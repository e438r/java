<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width =device-width, initial-scale=1, maximum-scale=1"/>
    <title></title>
    <meta charset="utf-8"/>
    <!--layui的css-->
    <script type="text/javascript" src="/jquery/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="/suiNavbar/sui.nav.min.js"></script>
    <script type="text/javascript" src="/layer/layer.js"></script>
    <script type="text/javascript" src="/common/common.js"></script>
    <script type="text/javascript" src="/layui/layui.all.js"></script>
    <script type="text/javascript" src="/layui/layui-xtree.js"></script>
    <script type="text/javascript" src="/menu/dist/typeit.min.js"></script>
    <script type="text/javascript" src="/menu/src/scripts.min.js"></script>
    <script type="text/javascript" src="/numberCount/count.js"></script>
    <script type="text/javascript" src="/bootstrap/js/bootstrap-treeview.js"></script>

    <link rel="stylesheet" type="text/css" href="/suiNavbar/sui.nav.css"/>
    <link rel="stylesheet" type="text/css" href="/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="/menu/dist/typeit.min.css"/>
    <link rel="stylesheet" type="text/css" href="/menu/src/style.css"/>
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap-treeview.css">
    <style type="text/css">

    </style>
</head>
<body>
<form class="layui-form layui-form-pane"
      style="width: 600px; height: 150px; float: left;margin-left: 15px; margin-top: 15px">
    <div class="layui-form-item">
        <label class="layui-form-label">手机号</label>
        <div class="layui-input-block">
            <input id="phone" type="text" name="phone" required lay-verify="required" placeholder="请输入账号名"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">用户名</label>
        <div class="layui-input-block">
            <input id="userName" type="text" name="userName" required lay-verify="required" placeholder="请输入用户名"
                   autocomplete="off" class="layui-input">
        </div>
    </div>
</form>
<button class="layui-btn layui-btn layui-btn-lg" onclick="newUser()" data-type="auto"
        style="position:absolute; left: 700px;top: 75px">新增用户
</button>
<button class="layui-btn layui-btn layui-btn-lg" onclick="getUser()" data-type="auto"
        style="position:absolute; left: 800px;top: 75px">用户查询
</button>
<table id="userTable" width="100%" lay-filter="demoEvent"></table>
</body>
<script>

    var userTable;

    layui.use('form', function () {
        var form = layui.form;
        form.render();
    });

    function newUser() {


    }

    function getUser() {
        var phone = $("#phone").val();
        var userName = $("#userName").val();

        var json = new Object();
        json.phone = phone;
        json.userName = userName;

        $.post('/user/list', json, function (data) {
            if (data.data.length == 0) {
                layer.open({
                    title: '错误信息'
                    , content: '没有找到用户'
                });

            } else {
                layui.use('table', function () {
                    userTable = layui.table;
                    userTable.render({
                        elem: '#userTable'
                        , data: data.data
                        , cols: [[
                            {field: 'id', title: '序号', width: 100}
                            , {field: 'phone', title: '账号名', width: 200}
                            , {field: 'userName', title: '用户名称', width: 200}
                            , {field: 'opeDepId', title: '部门编码', width: 200}
                            , {field: 'depName', title: '部门名称', width: 200}
                            , {field: 'userState', title: '用户状态', width: 200}
                            , {
                                title: '操作(默认显示前十条)', minWidth: 400, toolbar: '<div class="layui-btn-group">\n' +
                                '<button class="layui-btn" onclick="editUser(this)" style="margin: 0">编辑</button>\n' +
                                '<button class="layui-btn" onclick="forbidUser(this)" style="margin: 0">停用</button>\n' +
                                '<button class="layui-btn" onclick="enableUser(this)" style="margin: 0">启用</button>\n' +
                                '</div>'
                            }
                        ]]
                        , page: true
                        , skin: "line"
                        , id: 'userTable'
                        , count: data.count
                    })
                })
            }
        });

    }

    function enableUser(btn) {
        var id = $(btn).parent().parent().parent().children("td[data-field='id']").text();
        var phone = $(btn).parent().parent().parent().children("td[data-field='phone']").text();
        var userName = $(btn).parent().parent().parent().children("td[data-field='userName']").text();
        var userState = $(btn).parent().parent().parent().children("td[data-field='userState']").text();
        if (userState == 'NORMAL') {
            layer.open({
                title: '错误信息'
                , content: '用户已经处于NORMAL状态'
            });
            return;
        }
        layer.msg('确定要启用[' + phone + ']吗', {
            time: 20000,
            btn: ['确定', '我再想想'],
            yes: function () {
                var json = new Object();
                json.id = id;
                json.phone = phone;
                json.userName = userName;
                $.post('/user/enableUser', json, function (result) {
                    userTable.reload('userTable', {data: result.data});
                });
                layer.closeAll();
            },
            btn2: function () {
                layer.closeAll();
            }
        });
    }

    function forbidUser(btn) {
        var id = $(btn).parent().parent().parent().children("td[data-field='id']").text();
        var phone = $(btn).parent().parent().parent().children("td[data-field='phone']").text();
        var userName = $(btn).parent().parent().parent().children("td[data-field='userName']").text();
        var userState = $(btn).parent().parent().parent().children("td[data-field='userState']").text();
        if (userState == 'INVALID') {
            layer.open({
                title: '错误信息'
                , content: '用户已经处于INVALID状态'
            });
            return;
        }
        layer.msg('确定要禁用[' + phone + ']吗', {
            time: 20000,
            btn: ['确定', '我再想想'],
            yes: function () {
                var json = new Object();
                json.id = id;
                json.phone = phone;
                json.userName = userName;
                $.post('/user/forbidUser', json, function (result) {
                    userTable.reload('userTable', {data: result.data});
                });
                layer.closeAll();
            },
            btn2: function () {
                layer.closeAll();
            }
        });
    }

    function editUser(btn) {
        var phone = $(btn).parent().parent().parent().children("td[data-field='phone']").text();
        layer.open({
            type: 2,
            title: '用户信息'
            , content: '/role/role?phone='+phone
        });
    }

</script>
</html>